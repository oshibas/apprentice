# データをグルーピングできる
## 1. グルーピング
> 給与情報(salaries テーブル)から、従業員ごとに salary が何レコード登録されているかを取得し、従業員番号と登録レコード数を10件表示してください。
- GROUP BY 句: 従業員番号(emp_no)ごとにグルーピング
- COUNT 関数: レコード数を取得
```sql
SELECT emp_no, COUNT(*) AS count FROM salaries GROUP BY emp_no LIMIT 10;
+--------+-------+
| emp_no | count |
+--------+-------+
|  10001 |    17 |
|  10002 |     6 |
|  10003 |     7 |
|  10004 |    16 |
|  10005 |    13 |
|  10006 |    12 |
|  10007 |    14 |
|  10008 |     3 |
|  10009 |    18 |
|  10010 |     6 |
+--------+-------+
10 rows in set (0.00 sec)
```

## 2. グルーピングと集計関数
> 従業員番号10001から10010の従業員ごとの最小給与と最大給与を取得してください。
- MIN関数とMAX関数: それぞれの従業員番号に対してMINとMAXをグループ化して求める。
- WHERE句: 対象となる従業員番号の範囲を指定。

```sql
SELECT emp_no, MIN(salary), MAX(salary) FROM salaries WHERE emp_no BETWEEN 10001 AND 10010 GROUP BY emp_no;
+--------+-------------+-------------+
| emp_no | MIN(salary) | MAX(salary) |
+--------+-------------+-------------+
|  10001 |       60117 |       88958 |
|  10002 |       65828 |       72527 |
|  10003 |       40006 |       43699 |
|  10004 |       40054 |       74057 |
|  10005 |       78228 |       94692 |
|  10006 |       40000 |       60098 |
|  10007 |       56724 |       88070 |
|  10008 |       46671 |       52668 |
|  10009 |       60929 |       94443 |
|  10010 |       72488 |       80324 |
+--------+-------------+-------------+
10 rows in set (0.00 sec)
```

## 3. グルーピングと集計関数2
> 従業員番号10001から10010の従業員ごとの勤務開始日と勤務終了日を取得してください。なお勤務中の場合、勤務終了日は 9999-01-01 となります。

- SELECT：emp_no, MIN(from_date), IF(MAX(to_date) = '9999-01-01', '現在勤務中', MAX(to_date))を取得。
- FROM：salariesテーブルからデータを取得。
- WHERE：emp_noが10001から10010までの従業員のみを対象にする。
- GROUP BY：emp_noによってグループ化する。
- MIN()：各従業員の最初の雇用日を取得。
- IF()：最後の雇用日が9999-01-01の場合、「現在勤務中」と表示する。
- MAX()：各従業員の最後の雇用日を取得。
```sql
SELECT emp_no, MIN(from_date), IF(MAX(to_date) = '9999-01-01', '現在勤務中', MAX(to_date)) FROM salaries WHERE emp_no BETWEEN 10001 AND 10010 GROUP BY emp_no;
+--------+----------------+------------------------------------------------------------------+
| emp_no | MIN(from_date) | IF(MAX(to_date) = '9999-01-01', '現在勤務中', MAX(to_date))      |
+--------+----------------+------------------------------------------------------------------+
|  10001 | 1986-06-26     | 現在勤務中                                                       |
|  10002 | 1996-08-03     | 現在勤務中                                                       |
|  10003 | 1995-12-03     | 現在勤務中                                                       |
|  10004 | 1986-12-01     | 現在勤務中                                                       |
|  10005 | 1989-09-12     | 現在勤務中                                                       |
|  10006 | 1990-08-05     | 現在勤務中                                                       |
|  10007 | 1989-02-10     | 現在勤務中                                                       |
|  10008 | 1998-03-11     | 2000-07-31                                                       |
|  10009 | 1985-02-18     | 現在勤務中                                                       |
|  10010 | 1996-11-24     | 現在勤務中                                                       |
+--------+----------------+------------------------------------------------------------------+
10 rows in set (0.00 sec)
```

## 4. 絞り込み
> 従業員ごとの最大給与を求め、そのうち最大給与が140,000を超えている従業員の従業員番号と最大給与を取得してください。
- "salaries"テーブルからemp_noとsalary列を取得。
- emp_noでグループ化。
- HAVING句: MAX(salary)が140,000ドルより大きい行だけを返す。
- メモ: 14万ドルは 約1,880万らしい。（2023/05/06現在）
```sql
SELECT emp_no, MAX(salary) FROM salaries GROUP BY emp_no HAVING MAX(salary) > 140000;
+--------+-------------+
| emp_no | MAX(salary) |
+--------+-------------+
|  11486 |      145732 |
|  12149 |      141114 |
|  13386 |      144434 |
|  14487 |      144534 |
|  18006 |      144866 |
|  18997 |      145215 |
|  24099 |      141197 |
|  36219 |      148820 |
|  37558 |      149440 |
|  39964 |      142638 |
|  41822 |      146100 |
|  43624 |      158220 |
|  44188 |      140500 |
|  44465 |      146719 |
|  46439 |      150345 |
|  47286 |      140138 |
|  47978 |      155709 |
|  49232 |      141399 |
|  51531 |      142181 |
|  53402 |      146507 |
|  56012 |      141824 |
|  58746 |      142413 |
|  66793 |      150052 |
|  72680 |      140468 |
|  76125 |      141423 |
|  78008 |      144485 |
|  80823 |      154459 |
|  80937 |      142485 |
|  84052 |      142846 |
|  89825 |      143644 |
|  91935 |      147469 |
|  96957 |      143950 |
|  98169 |      144088 |
| 102078 |      140974 |
| 102962 |      146655 |
| 107140 |      142506 |
| 109334 |      155377 |
| 205000 |      153715 |
| 210661 |      145902 |
| 212558 |      140055 |
| 214842 |      143183 |
| 218237 |      141631 |
| 220051 |      142647 |
| 225306 |      144142 |
| 232753 |      147480 |
| 236748 |      141680 |
| 237069 |      140742 |
| 237542 |      152687 |
| 237674 |      145901 |
| 237694 |      141431 |
| 238117 |      152220 |
| 239311 |      143727 |
| 246120 |      146292 |
| 248492 |      143727 |
| 253939 |      155513 |
| 254247 |      142082 |
| 254466 |      156286 |
| 257360 |      144748 |
| 258761 |      146755 |
| 263955 |      146882 |
| 265296 |      142694 |
| 266526 |      152710 |
| 266639 |      142426 |
| 267069 |      141003 |
| 272431 |      145441 |
| 276633 |      152412 |
| 279776 |      150740 |
| 282030 |      142184 |
| 282370 |      141488 |
| 400122 |      144563 |
| 406747 |      142869 |
| 408988 |      144205 |
| 413137 |      142395 |
| 415751 |      146280 |
| 416972 |      140192 |
| 418416 |      141407 |
| 419748 |      140784 |
| 421835 |      141953 |
| 422084 |      144560 |
| 425675 |      142319 |
| 432583 |      143937 |
| 435435 |      144303 |
| 438507 |      140332 |
| 447240 |      140332 |
| 447849 |      145960 |
| 451883 |      140357 |
| 466852 |      145128 |
| 467956 |      142914 |
| 476883 |      141160 |
| 477358 |      140077 |
| 484736 |      141578 |
| 485205 |      141555 |
| 492164 |      148696 |
| 492633 |      143148 |
| 493158 |      154376 |
| 494128 |      141990 |
| 494152 |      140801 |
+--------+-------------+
97 rows in set (0.53 sec)
```

## 5. 最小給与
> 従業員番号10001から10100の従業員のうち、最小給与が40,000を下回っている従業員の従業員番号とその最小給与を取得してください。
- 従業員番号(emp_no)が10001から10100までの範囲にある従業員。
- その最低給与(MIN(salary))を取得。
- GROUP BY句: 従業員番号(emp_no)でグループ化。
- HAVING句: グループ化された各従業員の最低給与(MIN(salary))が40000未満である場合に限定。
- => 従業員番号と最低給与の2つの列から構成され、7行のレコードが返される。

```sql
SELECT emp_no, MIN(salary) FROM salaries WHERE emp_no BETWEEN 10001 AND 10100 GROUP BY emp_no HAVING MIN(salary) < 40000;
+--------+-------------+
| emp_no | MIN(salary) |
+--------+-------------+
|  10022 |       39935 |
|  10027 |       39520 |
|  10037 |       39765 |
|  10048 |       39507 |
|  10049 |       39735 |
|  10064 |       39551 |
|  10072 |       39567 |
+--------+-------------+
7 rows in set (0.04 sec)
```

## 6. 最終勤務日
> 従業員番号10001から10100の従業員のうち、勤務が終了している従業員の従業員番号と最後の勤務終了日を取得してください。なお勤務中の場合、勤務終了日は 9999-01-01 となります。
- 給与表(salaries)から、従業員番号(emp_no)が10001から10100までの従業員。
- そのうち、最低給与(MIN(salary))が40,000未満のものを抽出。
- 結果は、emp_noとMIN(salary)の2列からなり、7行の結果が返される。

```sql
SELECT emp_no, MAX(to_date) FROM salaries WHERE emp_no BETWEEN 10001 AND 10100 AND to_date != '9999-01-01' GROUP BY emp_no;
+--------+--------------+
| emp_no | MAX(to_date) |
+--------+--------------+
|  10001 | 2002-06-22   |
|  10002 | 2001-08-02   |
|  10003 | 2001-12-01   |
|  10004 | 2001-11-27   |
|  10005 | 2001-09-09   |
|  10006 | 2001-08-02   |
|  10007 | 2002-02-07   |
|  10008 | 2000-07-31   |
|  10009 | 2002-02-14   |
|  10010 | 2001-11-23   |
|  10011 | 1996-11-09   |
|  10012 | 2001-12-16   |
|  10013 | 2001-10-16   |
|  10014 | 2001-12-27   |
|  10015 | 1993-08-22   |
|  10016 | 2002-02-10   |
|  10017 | 2002-08-01   |
|  10018 | 2002-03-30   |
|  10019 | 2002-04-29   |
|  10020 | 2001-12-29   |
|  10021 | 2002-07-15   |
|  10022 | 2001-09-02   |
|  10023 | 2001-09-26   |
|  10024 | 2002-06-13   |
|  10025 | 1997-10-15   |
|  10026 | 2002-03-18   |
|  10027 | 2002-03-31   |
|  10028 | 1998-04-06   |
|  10029 | 2001-09-15   |
|  10030 | 2002-02-15   |
|  10031 | 2001-08-29   |
|  10032 | 2002-06-17   |
|  10033 | 1993-03-24   |
|  10034 | 1999-10-31   |
|  10035 | 2001-09-02   |
|  10036 | 2002-04-26   |
|  10037 | 2001-12-02   |
|  10038 | 2001-09-17   |
|  10039 | 2002-01-15   |
|  10040 | 2002-02-12   |
|  10041 | 2001-11-09   |
|  10042 | 2000-08-10   |
|  10043 | 2001-10-17   |
|  10044 | 2002-05-19   |
|  10045 | 2001-11-15   |
|  10046 | 2002-06-18   |
|  10047 | 2002-03-28   |
|  10048 | 1987-01-27   |
|  10049 | 2002-05-02   |
|  10050 | 2001-12-22   |
|  10051 | 2001-10-13   |
|  10052 | 2002-01-30   |
|  10053 | 2001-11-11   |
|  10054 | 2002-07-27   |
|  10055 | 1995-07-22   |
|  10056 | 2002-01-29   |
|  10057 | 2002-01-12   |
|  10058 | 2002-04-22   |
|  10059 | 2002-06-23   |
|  10060 | 2002-05-25   |
|  10061 | 2001-11-29   |
|  10062 | 2001-08-27   |
|  10063 | 2002-04-04   |
|  10064 | 1992-03-02   |
|  10065 | 2002-05-23   |
|  10066 | 2002-02-22   |
|  10067 | 2002-02-28   |
|  10068 | 2001-08-03   |
|  10069 | 2002-06-12   |
|  10070 | 2001-10-10   |
|  10071 | 2001-08-03   |
|  10072 | 2002-05-18   |
|  10073 | 1998-02-22   |
|  10074 | 2001-08-10   |
|  10075 | 2001-01-15   |
|  10076 | 2002-07-14   |
|  10077 | 2001-12-21   |
|  10078 | 2001-09-27   |
|  10079 | 2001-12-11   |
|  10080 | 2001-09-26   |
|  10081 | 2001-10-26   |
|  10082 | 1990-01-15   |
|  10083 | 2002-03-27   |
|  10084 | 2001-12-13   |
|  10085 | 2002-04-06   |
|  10086 | 2002-02-16   |
|  10087 | 2001-01-09   |
|  10088 | 2001-08-30   |
|  10089 | 2002-01-07   |
|  10090 | 1999-05-07   |
|  10091 | 2001-11-16   |
|  10092 | 2002-04-21   |
|  10093 | 2002-06-07   |
|  10094 | 1997-11-08   |
|  10095 | 2002-03-08   |
|  10096 | 2002-01-22   |
|  10097 | 2001-09-12   |
|  10098 | 1992-12-11   |
|  10099 | 2001-10-15   |
|  10100 | 2001-09-17   |
+--------+--------------+
100 rows in set (0.00 sec)
```
